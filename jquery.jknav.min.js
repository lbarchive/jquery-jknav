!function(e){function t(t){var n=window.console;e.jknav.DEBUG&&n&&n.log&&n.log("jknav: "+t)}function n(e){return e.toLowerCase().match(/(chrome|webkit)[ \/]([\w.]+)/)}function a(t,n){var a=e.jknav.items[n.name][t][1];a&&a(e.jknav.items[n.name][t][0])}function o(n,a){var o=e.jknav.index[a.name];if(t("Calculating index for "+a.name+", current index = "+o),null==o){var r=e(e.jknav.TARGET).scrollTop();t(e.jknav.TARGET+" top = "+r),e.each(e.jknav.items[a.name],function(t,n){var a=Math.floor(e(n).offset().top);r>=a&&(o=t)}),null==o?o=n>0?0:e.jknav.items[a.name].length-1:n>0&&++o>=e.jknav.items[a.name].length?a.circular&&(o=0):0>n&&r==Math.floor(e(e.jknav.items[a.name][o]).offset().top)&&--o<0&&a.circular&&(o=e.jknav.items[a.name].length-1)}else{if(!a.circular&&(0==o&&-1==n||o==e.jknav.items[a.name].length-1&&1==n))return o;o+=n,o>=e.jknav.items[a.name].length&&(o=0),0>o&&(o=e.jknav.items[a.name].length-1)}return t("new index = "+o),e.jknav.index[a.name]=o,o}function r(n,r){if("input"==n.target.tagName.toLowerCase()||"button"==n.target.tagName.toLowerCase()||"select"==n.target.tagName.toLowerCase()||"textarea"==n.target.tagName.toLowerCase())return void t("keyup: "+n.target.tagName+", target is INPUT ignored.");var i=String.fromCharCode(n.keyCode).toLowerCase();if(t("keyup: "+n.target.tagName+", key: "+i),i==r.up.toLowerCase()||i==r.down.toLowerCase()){r.reevaluate&&(e.jknav.index[r.name]=null);var s=o(i==r.down.toLowerCase()?1:-1,r);if(void 0!==e.jknav.items[r.name][s]){var f=e(e.jknav.items[r.name][s][0]);e(e.jknav.TARGET).animate({scrollLeft:Math.floor(f.offset().left),scrollTop:Math.floor(f.offset().top)},r.speed,r.easing,function(){a(s,r)})}}}e.fn.jknav=function(t,n){return null==n&&(n="default"),null==e.jknav.items[n]&&(e.jknav.items[n]=[]),this.each(function(){e.jknav.items[n].push([this,t]),e.jknav.items[n].sort(function(t,n){var a=e(t[0]).offset().top,o=e(n[0]).offset().top;if(o>a)return-1;if(a>o)return 1;if(a==o){var r=e(t[0]).offset().left,i=e(n[0]).offset().left;return i>r?-1:r>i?1:0}})})},e.jknav={index:{},items:{},opts:{},default_options:{up:"k",down:"j",name:"default",easing:"swing",speed:"normal",circular:!0,reevaluate:!1},DEBUG:!1,TARGET_KEYUP:"html",TARGET:n(navigator.userAgent)?"body":"html",init:function(n){var a=e.extend(e.extend({},e.jknav.default_options),n);e.jknav.index[a.name]=null,e.jknav.opts[a.name]=a,e(e.jknav.TARGET_KEYUP).keyup(function(e){r(e,a)}),t('new set "'+a.name+'" initialzed.')},up:function(t){var n=e.jknav.opts[t||"default"];r({target:{tagName:""},keyCode:n.up.charCodeAt(0)},n)},down:function(t){var n=e.jknav.opts[t||"default"];r({target:{tagName:""},keyCode:n.down.charCodeAt(0)},n)}}}(jQuery);